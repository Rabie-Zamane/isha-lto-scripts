#summary Script used to prepare a collection pre-prepared archives for writing to lto tape

= Introduction =

This script performs the following functions:

  * Recalculates all file "block" offset values depending on the order the archives will be written to tape, and generates an Index.xml file from all the pre-prepared "tag" fragments (updating the block attributes accordingly). Also calculates and updates the tar file position/md5/block attributes. Adds the top-level index timestamp attribute.

= Details =

To run this script, all the pre-prepared archives must be placed in the "lto-stage" directory. Each archive must be named session-id-device-id (e.g. n65-1-v1), and the corresponding tar xml fragments must be in the same directory, and named the same way (e.g. n65-1-v1.xml)

The script performs the following steps:

Step 1: Check that the total filesize of all the archives is <= 370GB

Step 2: Generate the full index.xml file, by looping through the archive files and andding each tar element, updating the "block" attribute values on the way.

Step 3: Generate a file listing the files to be written to tape (in the correct order)

e.g.

index.xml
n65-1-v1.tar
n65-1.v2.tar
p32-1.v1.tar
...
...

(This file will be passed to the actual lto-write script - to ensure that the files are written to tape in the correct order - otherwise the block offsets may be wrong).