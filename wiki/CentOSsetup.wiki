#summary Instructions on how to configure CentOS with necessary software

= Introduction =

This document contains the instructions on how to install and configure the CentOS Operating System, installing the necessary software and hardware, to be able to perform the LTO backups, and to run the TranscriptStudio application.


== Why CentOS ==

We have chosen to use the Linux OS because it is generally considered to offer greater stability, security when compared to Microsoft Windows. We also wanted to use an open source model for our data backup architecture, to avoid storing our data in proprietary formats, and therefore avoid the risk of being unable to access it in the future due to software version incompatibilities or discontinuities. For this reason Linux was the natural choice. 

The reason why we have chosen the CentOS distribution of Linux is primarily because we are using an HP Tape Drive (Storageworks Ultrium 920 External SCSI) together with an HP SCSI HBA Card [http://h20000.www2.hp.com/bizsupport/TechSupport/SoftwareIndex.jsp?lang=en&cc=us&prodNameId=3191202&prodTypeId=329290&prodSeriesId=3191201&swLang=8&taskId=135&swEnvOID=4006 (SC11Xe PCIe Ultra320)], both of which are only supported, (and have drivers/firmware available) for the enterprise versions of either RHEL or SUSE. 

CentOS aims to be, as far as possible, a "binary clone" of RHEL (using the freely available source code under the GPL license), but with the advantage of being free. Using an "enterprise" distribution also means that we are less at risk from bugs introduced by having the "latest and greatest" updates, which might be the case with using an OS like Ubuntu for example.


== Installing CentOS ==

We need to install the latest version of CentOS (with the CentOS Plus repository enabled, and with the CentOSPlus kernel). The CentOS Plus repository contains extra packages which are not in the official RedHat distribution - so it means that is "unsupported". However, we require the firewire IE1394 support, which is only enabled in the CentOS Plus kernel)

We also need to enable the 3rd part repository RPMForge in order to get the gparted partitioning package. See [http://wiki.centos.org/AdditionalResources/Repositories/RPMForge/ here] for guidelines on how to do this

== Hardware Installation ==

We are using the following hardware:
  * IBM System x3400 (7973) Server
  * HP Storageworks Ultrium 920 LTO-3 External Scsi Tape Drive
  * HP SC11Xe Ultra 320 PCIe HBA card (OEM version of LSI card)
  * 2 Western Digital Velociraptor 10000rpm 300GB Sata Hard Disks


=== Installing the HP SC11Xe HBA card ===

We used the LSI Logic driver, available from [http://www.lsi.com/storage_home/products_home/host_bus_adapters/scsi_hbas/lsi20320ie/ here]. We installed the dkms rpm and then the mptlinux-dkms rpm.

(Note: The official HP driver for this card is available [http://h20000.www2.hp.com/bizsupport/TechSupport/SoftwareDescription.jsp?lang=en&cc=uk&prodTypeId=329290&prodSeriesId=3191201&swItem=MTX-0cfb66c3937346129f6ce9ed13&prodNameId=3191202&swEnvOID=4006&swLang=8&taskId=135&mode=4&idx=2 here], but we found that it gave sub-optimal performance compared to the LSI driver, as well as restricting us to a particular kernel version. With the HP driver the tape drive was able to write around 95% capacity of the tape - 375GB out of 391GB, whereas the LSI driver was able to write close to 100% capacity - both at around 55MBps. 

If for any strange reason we need to use the HP driver, a couple of things (hacks) need to be done to make the installation work properly.

  # Change the value stored in the file /etc/redhat-release from "CentOS release 5.3 (Final)" to "Red Hat Enterprise Linux Server release 5 (Tikanga)". If you don't do this, then the the installation will fail with a message saying that you don't have the correct distribution.

  # Prevent mkinitrd from requiring the dm-mem-cache module. This can be accomplished by executing the following commands as root:

  # echo "DMRAID=no" > /etc/sysconfig/mkinitrd/noraid
  # chmod 755 /etc/sysconfig/mkinitrd/noraid

More information on what this means can be found [http://kbase.redhat.com/faq/docs/DOC-16528 here]

=== Rescanning the SCSI bus ===

If the server is powered on before the tape drive, then the tape drive will not be detected automatically after it is switched on. To get the server to detect the tape drive without having to restart the server you can rescan the scsi bus, by entering the following command as root:

  * echo "- - -" > /sys/class/scsi_host/host?/scan

(replacing "?" with the number of the host - e.g. 0, 1, 2, 3)

=== Enabling Firewire ===

In order to facilitate receiving and offloading large amounts of data, we have decided to use a firewire connection to the server.

By default RedHat/CentOS does not have firewire support enabled in the kernel. This means that either one must recompile the kernel enabling the appropriate kernel modules - or more easily - upgrade to the CentOSPlus kernel, which has firewire support enabled. (We have chosen the latter - for the sake of simplicity).

...Stuff about editing YUM configuration files (exclude and priority options)...

NOTE: If using the HP HBA Card driver this would cause a problem since the HP HBA card requires us to have one of a specified list of kernel versions  - of which the CentOSPlus kernel is not one of.

== Software Installation ==

=== Installing Java ===

Get the latest version of the Java jdk from [http://java.sun.com/javase/downloads/index.jsp Sun's website]. Move the binary executable to /opt and execute it as root.

Clear instructions on how to perform the installation can be found [http://www.cyberciti.biz/faq/linux-unix-set-java_home-path-variable/ here]. (See the comments by Mustafa Buljubasic)

Set the $JAVA_HOME and $PATH system environment variables by executing the following commands as root:

  * echo export JAVA_HOME=/usr/local/java > /etc/profile.d/jdk.sh
  * echo export PATH=$JAVA_HOME/bin:$PATH >> /etc/profile.d/jdk.sh

=== Installing eXist ===

Get the latest stable version of the eXist xml database from [http://exist.sourceforge.net/download.html here].

Install it by typing the following command as root

  * java -jar eXist-{version}.jar -p /usr/local/exist

Note: this will create the admin user with a blank password - so you must set this as soon as possible afterwards to secure your database.

Set the $EXIST_HOME system environment variable by executing the following command as root:

  * echo export EXIST_HOME=/usr/local/exist > /etc/profile.d/exist.sh

To configure eXist to start as a service...

=== Installing the Flash Player plugin ===

You can get the latest Flash Player plugin from [http://get.adobe.com/flashplayer/ here], and select the YUM download option.

=== Installing ts4isha ===

After installing, point your web browser at [http://localhost:8080/exist/ts4isha/TranscriptStudio.swf] to access the Transcript Studio application.

== General Hints ==

This section contains some general information about how to perform some of the commonly used tasks in CentOS

=== Package Management with YUM ===

su -c 'yum install tsclient' (Installs tsclient)
su -c 'yum update tsclient' (Updates tsclient to the latest version)
su -c 'yum remove tsclient' (Removes tsclient from the system)
su -c 'yum list tsclient' (Searches for package named tsclient)
su -c 'yum list tsc\*' (Search using wildcard)

=== Required Packages ===

  * ImageMagick
  * subversion
  * ffmpeg


Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages